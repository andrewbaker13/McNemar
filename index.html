<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>McNemar Test Explorer</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header>
        <h1>McNemar Test Explorer</h1>
        <p>Investigate matched, binary outcomes with a contingency heatmap, effect-size diagnostics, and automated reporting.</p>
    </header>

    <main>
        <section class="equation-section">
            <h2>Key Equations</h2>
            <p>McNemar’s test spotlights the “switchers”—people who respond under one condition but not the other:</p>
            <div class="equation-display">
                \[
                \begin{aligned}
                \chi^2_{\text{McNemar}} &= \frac{(b - c)^2}{b + c} \\
                \chi^2_{\text{Corrected}} &= \frac{(|b - c| - 1)^2}{b + c} \\
                p_{\text{exact}} &= 2 \times \min \Bigg( \sum_{i=0}^{b} \binom{b + c}{i} 0.5^{b + c},\;
                \sum_{i=0}^{c} \binom{b + c}{i} 0.5^{b + c} \Bigg)
                \end{aligned}
                \]
            </div>
            <div class="equation-definitions">
                <p><strong>Where:</strong></p>
                <ul>
                    <li>\(b\) counts people who only converted under Condition A, \(c\) only under Condition B. These one-sided wins fuel the test.</li>
                    <li>\(\chi^2\) statistics approximate the exact binomial test; the continuity correction keeps Type I error in check when switchers are scarce.</li>
                    <li>The exact approach treats the direction of switchers as a fair coin and doubles the smaller binomial tail.</li>
                </ul>
            </div>
            <div class="equation-note">
                <h3>What the test answers</h3>
                <p>
                    If one-sided wins favor a condition more than chance would allow, we reject the idea that both variants share the same success probability.
                </p>
                <p>
                    See the
                    <a href="https://en.wikipedia.org/wiki/McNemar%27s_test" target="_blank" rel="noopener noreferrer">
                        McNemar test article on Wikipedia
                    </a>
                    for a deeper derivation.
                </p>
            </div>
        </section>

        <section class="scenario-section">
            <h2>Practical Scenario</h2>
            <div class="scenario-controls">
                <label for="scenario-select">Select a marketing scenario:</label>
                <select id="scenario-select">
                    <option value="">Manual inputs (no preset)</option>
                </select>
            </div>
            <div id="scenario-description">
                <p>
                    Choose a preset to auto-fill the matched table for common marketing diagnostics, or stay on
                    “Manual inputs” to describe your own test. Drop additional <code>.txt</code> files into the
                    <code>scenarios</code> folder and reference them in <code>scenario-index.json</code> to extend the menu.
                </p>
            </div>
        </section>

        <section class="input-stack">
            <article class="card pair-card">
                <h2>Matched Outcome Table</h2>
                <p>Enter how many people landed in each combination of outcome + condition. Name the two outcome states (e.g., “Converted” vs “No conversion”) so your table matches the story.</p>

                <div class="label-grid">
                    <div class="input-group">
                        <label for="condition-a-label">Condition A label</label>
                        <input type="text" id="condition-a-label" maxlength="60" placeholder="Condition A">
                    </div>
                    <div class="input-group">
                        <label for="condition-b-label">Condition B label</label>
                        <input type="text" id="condition-b-label" maxlength="60" placeholder="Condition B">
                    </div>
                    <div class="input-group">
                        <label for="positive-label">Outcome label (desired behavior)</label>
                        <input type="text" id="positive-label" maxlength="60" placeholder="Took desired action">
                    </div>
                    <div class="input-group">
                        <label for="negative-label">Outcome label (other behavior)</label>
                        <input type="text" id="negative-label" maxlength="60" placeholder="Did not take action">
                    </div>
                </div>

                <div class="contingency-wrapper" role="group" aria-labelledby="contingency-caption">
                    <p id="contingency-caption" class="visually-hidden">2×2 contingency table inputs</p>
                    <table class="contingency-table">
                        <thead>
                            <tr>
                                <th aria-hidden="true"></th>
                                <th aria-hidden="true" class="axis-label-col"></th>
                                <th id="condition-b-axis" colspan="2">Condition B outcome</th>
                            </tr>
                            <tr>
                                <th aria-hidden="true"></th>
                                <th aria-hidden="true" class="axis-label-col"></th>
                                <th id="col-positive-header">Condition B positive</th>
                                <th id="col-negative-header">Condition B negative</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th id="condition-a-axis" class="row-axis-label" scope="rowgroup" rowspan="2">Condition A outcome</th>
                                <th id="row-positive-header" scope="row">Condition A positive</th>
                                <td>
                                    <label class="visually-hidden" for="cell-a-pos-b-pos">A positive &amp; B positive</label>
                                    <input type="number" id="cell-a-pos-b-pos" min="0" step="1" value="0">
                                </td>
                                <td>
                                    <label class="visually-hidden" for="cell-a-pos-b-neg">A positive &amp; B negative</label>
                                    <input type="number" id="cell-a-pos-b-neg" min="0" step="1" value="0">
                                </td>
                            </tr>
                            <tr>
                                <th id="row-negative-header" scope="row">Condition A negative</th>
                                <td>
                                    <label class="visually-hidden" for="cell-a-neg-b-pos">A negative &amp; B positive</label>
                                    <input type="number" id="cell-a-neg-b-pos" min="0" step="1" value="0">
                                </td>
                                <td>
                                    <label class="visually-hidden" for="cell-a-neg-b-neg">A negative &amp; B negative</label>
                                    <input type="number" id="cell-a-neg-b-neg" min="0" step="1" value="0">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="totals-row">
                        <div><strong id="total-a-positive-label">Total condition A positive:</strong> <span id="total-a-positive">0</span></div>
                        <div><strong id="total-a-negative-label">Total condition A negative:</strong> <span id="total-a-negative">0</span></div>
                        <div><strong>Total pairs:</strong> <span id="total-pairs">0</span></div>
                    </div>
                </div>
            </article>

            <article class="card settings-card">
                <h2>Analysis Settings</h2>
                <p class="helper-text">Stick with the default unless you have a specific testing requirement.</p>
                <div class="input-group inline">
                    <label for="alpha">Significance level (α):</label>
                    <input type="number" id="alpha" min="0.001" max="0.5" step="0.001" value="0.05">
                    <span class="helper-text">Confidence = 1 − α</span>
                </div>
                <div class="confidence-buttons" role="group" aria-label="Select shortcut confidence level">
                    <button class="conf-level-btn" data-level="0.90">90% CI</button>
                    <button class="conf-level-btn selected" data-level="0.95">95% CI</button>
                    <button class="conf-level-btn" data-level="0.99">99% CI</button>
                </div>
                <div class="analysis-guidance">
                    <p><strong>Which statistic should I use?</strong></p>
                    <ul>
                        <li><strong>Let the app decide</strong> (default): continuity-corrected chi-square keeps false positives in check.</li>
                        <li><strong>No correction</strong>: use when you have 25+ switchers and want a hair more power.</li>
                        <li><strong>Exact binomial</strong>: safest when you have fewer than ~25 switchers.</li>
                    </ul>
                </div>
                <details class="advanced-method">
                    <summary>Advanced: Override the test statistic</summary>
                    <div class="input-group">
                        <label for="analysis-method">Primary method</label>
                        <select id="analysis-method">
                            <option value="chi2_cc">Chi-square (continuity-corrected)</option>
                            <option value="chi2_nocc">Chi-square (no correction)</option>
                            <option value="exact">Exact binomial</option>
                        </select>
                    </div>
                    <p class="helper-text">Only change this if you have a documented testing rule.</p>
                </details>
                <div class="input-group checkbox">
                    <input type="checkbox" id="show-odds-ratio" checked>
                    <label for="show-odds-ratio">Show odds-ratio effect size and confidence interval</label>
                </div>
            </article>
        </section>

        <section class="results-stack">
            <article class="card plot-card">
                <h2 id="matrix-chart-title">Contingency Heatmap</h2>
                <div id="matrix-chart" class="plot-container" role="img" aria-live="polite" aria-label="Heatmap of the 2 by 2 contingency table."></div>
                <p id="matrix-caption" class="chart-caption"></p>
            </article>

            <article class="card stats-card">
                <h2>McNemar Test Output</h2>
                <div id="stats-grid" class="stats-grid" aria-live="polite">
                    <p>Enter paired counts to run the test.</p>
                </div>
                <div id="stats-explainer" class="stat-explainer"></div>
            </article>
        </section>

        <section class="narrative-stack">
            <article class="card">
                <h2>Switcher Narrative</h2>
                <div id="switcher-narrative"></div>
            </article>
            <article class="card">
                <h2>Reporting Automation</h2>
                <div class="reporting-layout">
                    <article class="report-card" aria-label="APA-style summary">
                        <h3>APA Style</h3>
                        <p id="apa-report"></p>
                    </article>
                    <article class="report-card" aria-label="Managerial summary">
                        <h3>Managerial Interpretation</h3>
                        <p id="managerial-report"></p>
                    </article>
                </div>
            </article>
        </section>

        <section>
            <details class="card diagnostic-panel">
                <summary>Diagnostics</summary>
                <div id="diagnostics-content">
                    <p>Run an analysis to populate diagnostics on switcher counts, balance, and assumption risk.</p>
                </div>
            </details>
        </section>

        <section>
            <article class="card">
                <h2>Summary Table</h2>
                <table class="summary-table">
                    <thead>
                        <tr>
                            <th>Cell</th>
                            <th>Count</th>
                            <th>Share of total</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="summary-table-body">
                        <tr>
                            <td colspan="4">Enter counts to see the full table.</td>
                        </tr>
                    </tbody>
                </table>
            </article>
        </section>
    </main>

    <footer>
        <p>Created: <span id="created-date"></span> | Last modified: <span id="modified-date"></span></p>
    </footer>

    <script src="app.js"></script>
</body>
</html>
